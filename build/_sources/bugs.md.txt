# 常见bugs记录，汇总，归类和分析


```{admonition} 前车之鉴，后事之师。
:class: warning

排雷指南
```




## 经典bugs

### 逻辑问题
- *状态机终态不可逆*

已经进入终态的状态，任何条件下都不能扭转

【资损事故：成功状态转为已过期触发自动退款】

- *幂等判断依据字段可信赖性*

缓存数据和异步写入的数据不可作为幂等依据，因为可能存在缓存失效、异步写入失败等问题导致幂等机制失效。

【资损事故：反向充值业务，用异步写入的数据作为幂等依据，因缓存bug+异步迟迟未落表导致幂等失效，重复加钱而造成资金损失】

- *异步任务阻塞*

【资损事故：异步任务阻塞，导致扣coins失败，积累大量的任务未扣减，造成资损】


### 细节错误
- *数组未判空、越界*
- *Json解析出错*
- *函数传参出错*
- *接口、DB字段类型长度不一致*

### 跨系统/语言交互
- *空值检测、Json、数组的不同解析*
- *接口交互的约定*

### 可维护性问题
- *枚举*
- *配置项*
- *抽离集中管理*
- *处理一致性*


